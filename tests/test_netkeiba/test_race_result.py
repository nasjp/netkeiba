import pandas as pd
import utils.request as request
from netkeiba.race_result import get_race_result
import numpy as np
from pandas.testing import assert_frame_equal


def test_get_race_result():
    race_id = "202206010101"
    # https://db.netkeiba.com/race/202206010101
    got_race_result = get_race_result(race_id, request.Client())

    assert_frame_equal(got_race_result, want_race_result)


# fmt: off
want_race_result = pd.DataFrame({
    "着順":        [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16],
    "枠番":        [8, 5, 2, 1, 8, 4, 5, 6, 4, 3, 1, 7, 3, 7, 6, 2],
    "馬番":        [15, 10, 4, 2, 16, 8, 9, 11, 7, 6, 1, 14, 5, 13, 12, 3],
    "馬名":        ["ニシノアナ", "トラストパッキャオ", "マイネルシトラス", "ピカリエ", "ブラッドライン", "デザートサファリ", "ニシノスーベニア", "ペルペテュエル", "アイアムラベンダー", "オールフラッグ", "サノプリ", "ヤマタケコーチャン", "キタノドーベル", "アイスケイブ", "ミュージアムピース", "コンセプシオン"],
    "性齢":        ["牝3", "牝3", "牡3", "牝3", "牡3", "牡3", "牡3", "牡3", "牝3", "牡3", "牝3", "牡3", "牝3", "牝3", "牡3", "牝3"],
    "斤量":        [51, 54, 56, 54, 56, 56, 56, 56, 54, 56, 51, 56, 54, 54, 56, 54],
    "騎手":        ["横山琉人", "菅原明良", "柴田大知", "伊藤工真", "Ｍ．デム", "丹内祐次", "内田博幸", "戸崎圭太", "松岡正海", "横山武史", "小林凌大", "丸田恭介", "武士沢友", "三浦皇成", "黛弘人", "斎藤新"],
    "タイム":      ["1:12.5", "1:12.5", "1:12.5", "1:12.8", "1:13.2", "1:13.4", "1:13.7", "1:13.7", "1:13.9", "1:13.9", "1:14.0", "1:14.2", "1:14.4", "1:14.5", "1:15.3", "1:16.0"],
    "着差":        [np.nan, "クビ", "クビ", "1.1/2", "2.1/2", "1", "1.3/4", "クビ", "3/4", "クビ", "1/2", "1.1/4", "1", "3/4", "5", "4"],
    "単勝":        [6.8, 57.2, 3.7, 16.0, 10.0, 6.3, 14.3, 6.2, 10.7, 12.6, 258.1, 239.2, 273.2, 25.3, 67.9, 32.8],
    "人気":        [4, 12, 1, 9, 5, 3, 8, 2, 6, 7, 15, 14, 16, 10, 13, 11],
    "馬体重":      ["456(+4)", "458(+2)", "518(-2)", "486(+6)", "478(-2)", "470(-4)", "536(+28)", "472(0)", "462(-2)", "478(+10)", "424(+6)", "444(+2)", "448(-2)", "432(+10)", "464(+24)", "528(+4)"],
    "調教師":      ["[東] 相沢郁", "[東] 高木登", "[東] 武市康男", "[東] 金成貴史", "[東] 伊藤大士", "[東] 岩戸孝樹", "[東] 上原博之", "[東] 武藤善則", "[東] 奥平雅士", "[東] 奥村武", "[東] 尾形和幸", "[東] 萱野浩二", "[東] 深山雅史", "[東] 高柳瑞樹", "[東] 伊藤大士", "[東] 水野貴広"],
    "race_id":    ["202206010101", "202206010101", "202206010101", "202206010101", "202206010101", "202206010101", "202206010101", "202206010101", "202206010101", "202206010101", "202206010101", "202206010101", "202206010101", "202206010101", "202206010101", "202206010101"],
    "horse_id":   ["2019103610", "2019100855", "2019103542", "2019104288", "2019101003", "2019101217", "2019101408", "2019102271", "2019104028", "2019105170", "2019102173", "2019102153", "2019101943", "2019105024", "2019104143", "2019106127"],
    "jockey_id":  ["01192", "01179", "01009", "01119", "05212", "01091", "00422", "05386", "01085", "01170", "01177", "01117", "01029", "01122", "01109", "01178"],
    "trainer_id": ["01020", "01088", "01089", "01132", "01109", "01051", "00423", "01064", "01074", "01145", "01141", "01024", "01174", "01118", "01109", "01094"],
    "owner_id":   ["897009", "125008", "546800", "064803", "427030", "855030", "897009", "252030", "505006", "486800", "735033", "631002", "163002", "506800", "629800", "547800"],
})
# fmt: on
